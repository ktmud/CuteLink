/**
* CuteLink v0.0.1
*
* Date: Wed Aug 3 18:31:26 2011 +0800
*
* Copyright given up 2011, Jianchao Yang.
*
* You can do whatever you want with this.
*
*/(function(a){a.mix(a,{_invoke:function(a,b){if(a)for(var c=0;c<a.length;c++)try{(new Function(a[c])).apply(b),_log(a[c]+"\u5df2\u89e6\u53d1")}catch(d){}},_log:function(){window._DEV_&&a.log.apply(a,arguments)}})})(KISSY),KISSY.add("cutelink",function(a){function d(){var b=this;a.mix(b,{_inited:!1,camps:{},callbacks:{}});return b}var b="data",c="params";a.mix(d,{camps:[],data:{},params:{}}),a.augment(d,a.EventTarget,{clear:function(c){a.isArray(c)?a.each(c,function(a){delete d[b][a]}):d[b]={}},init:function(b){var e=this;if(e._inited&&!b)return e;var b=a.mix({doRedirect:!0},b),f=window.location.href,g=initialParam=d.getLocParam(),h=d.getUrlPath(f);d[c][h]=g;var i=b.oninit;b.doRedirect&&!i?d.history.locCheck():a.isFunction(i)&&i.call(e,e.getUrlDetail(f)),e.fire("init",b),e._inited=!0;return e}}),a.CuteLink=d;return d}),KISSY.add("cutelink/urltools",function(a,b){function v(a){var b={},c,d=[];for(c in a)a.hasOwnProperty(c)&&d.push(c);d.sort();for(c=0;c<d.length;c++)b[d[c]]=a[d[c]];return b}function u(b,c,d){a.isObject(c)&&a.mix(b,c),a.isArray(d)&&a.each(d,function(a){delete b[a]});return b}function t(b,c){a.isString(b)&&(b=s(b));var d=b.hash_f,e=b.hash;if(!c&&d&&d.indexOf(g)==0)return e.indexOf(h)!=-1||e.indexOf(j)>0?e:b.path+j+e;return b.path+j+decodeURI(a[m](b.param))}function s(b){var d=b.match(e),f=d[1],i=d[2],k=d[3]||"",m=d[4],n=d[5],o=a[l](k),p={},q=r(b)||r(c.location.href),s,t=o;if(m&&m.indexOf(g)==0)if(n.indexOf(h)!=-1||n.indexOf(j)>0){var d=n.match(e);s=d[1],t=a[l](d[3])}else t=a[l](n);return{path:q,realPath:s||q,param:t,search:k,search_f:i,searchParam:o,hash:n,hash_f:m,hashParam:p}}function r(a){var b=c.location;return a.replace(d,i).replace(f,i).replace(b.protocol+h+h+b.host,i)}function q(a){return d.test(a)?a.match(d)[1]:i}function p(a){return f.test(a)?a.match(f)[0].replace(g,i):i}function o(){return c.location.hash.replace(g,i)}function n(){return a[l](c.location.search.replace(j,i))}var c=window,d=/\?(\w[^#]+)/,e=/([^#\?]*)(\?([^#\?]*))?(#!?([^#]*$))?/,f=/#[^#]*$/,g="#!",h="/",i="",j="?",k=",",l="unparam",m="param";a.mix(a.CuteLink,{getLocParam:n,getLocHash:o,getUrlPath:r,getUrlHash:p,getUrlSearch:q,getUrlDetail:s,getCleanUrl:t,mergeParam:u,makeRealQuery:function(b){var e=r(c.location.href),f=r(b)||e;if(!d.test(b))return{realPath:b,url:b,param:{}};var g=this.params,h=s(b),i=h[m],k=h.realPath,l=g[k];if(l){for(var n in l)i[n]||delete l[n];for(var n in i)if(!l[n]||l[n]!=i[n])l[n]=i[n]}else l=g[k]=i;l=v(l);var o=k+j+decodeURI(a[m](l));return{realPath:k,param:l,url:o}}})}),KISSY.add("cutelink/history",function(a,b){function n(a,b){var b=b||c.location;a===l?b.hash&&(b.href=b.href.replace(j,l)):b.hash=i+a}var c=window,d=document,e=a.all,f=a.Event,g=a.DOM,h=a.CuteLink,i="#!",j=/#[^#]*$/,k="__clrms",l="",m=!!c.history&&!!c.history.pushState;h.History=function(){this.handlers={}},a.augment(h.History,a.EventTarget,{getCrtUrl:function(){return h.getCleanUrl(c.location.href)},start:function(){var a=this;if(!a.started){a.started=!0;var b=a.getCrtUrl();m?f.on(c,"popstate",function(){a.checkUrl()}):"onhashchange"in window&&f.on(c,"hashchange",function(){a.checkUrl()}),a.current=b,a._hasPushState=m}},setHash:function(a,b){var c=this;n(a)},navigate:function(a,b,d){var e=this;b&&(e.prevHandler=e.handlers[a]=[b,d]),e._hasPushState?c.history.pushState(null,null,a):e.setHash(a),e.checkUrl(a)},loadUrl:function(b){var c=this.handlers[b],d,e;c?(d=c[0],e=c[1]):(c=this.prevHandler,d=c&&c[0]||h.defaultCamp),e?(e.data=h.data[b],e.hasCache=!a.isUndefined(e.data),d.doRequest(e)):d&&d.load(b)},checkUrl:function(a){var b=this,c=a||b.getCrtUrl();if(c==b.current)return!1;b.current=c,b.loadUrl(c)},locCheck:function(){var a=c.location;a.hash.indexOf(i)!=-1&&(a.href=this.current)}}),h.history=new h.History,h.history.start()}),KISSY.add("cutelink/register",function(a,b){function L(a){var b=this;b.init(a);return b}function J(b,c){if(a.isFunction(b))b.call(this,c);else if(a.isArray(b))g(b,this);else if(a.isObject(b)&&a.isObject(c))for(var d in c)try{b[d].call(this,c[d])}catch(e){h(e),h("\u6267\u884c "+d+" \u56de\u8c03\u51fa\u9519","warn"),h(c)}}function I(a,b){function l(a){if(a<k){a+=j;var b=H(a,d,i,k);setTimeout(function(){c.scrollTo(g,b)},a),l(a)}}var b=b||0,a=e(a);if(!!a.length){var d=f.scrollTop(),g=f.scrollLeft(),h=a.offset().top+b,i=h-d,j=20,k=400;if(Math.abs(d-h)<5)return;l(0)}}function H(a,b,c,d){return c*(Math.pow(a/d-1,5)+1)+b}function G(a,b){var c=a[0].tagName.toLowerCase(),d=b.split("|"),e=!1;for(var f=d.length-1;f>=0;f--)if(c==d[f]){e=!0;break}return e}function F(b,c){return a.isString(b)?b.indexOf(c)!=-1:!1}function E(a){return F(a,o)?"&":o}function D(a){function c(a){if(!a)return n;if(window.ActiveXObject)return a.replace(/[\d\D]/g,function(a){window.vbsval="",execScript('window.vbsval=Hex(Asc("'+a+'"))',"vbscript");return"%"+window.vbsval.slice(0,2)+"%"+window.vbsval.slice(-2)});b.href="?key="+a;return b.href.split("key=").pop()}var b=document.createElement("a");return a.replace(/([^\x00-\xff]+)|([\x00-\xff]+)/g,function(a,b,d){return c(b)+encodeURIComponent(d||"")})}var c=window,d=document,e=a.all,f=a.DOM,g=a._invoke,h=a._log,i=a.CuteLink,j=/\?(\w[^#]+)/,k=/([^#\?]*)(\?([^#\?]*))?(#!?([^#]*$))?/,l=/#[^#]*$/,m="/",n="",o="?",p=",",q="_cl-guid",r="status",s="cache",t="queue",u="init",v="parse",w="start",x="load",y="loaded",z="render",A="rendered",B="error",C="loading",K={dataType:"json",intf:"_self",intfAttr:"data-cl-intf",intfParam:n,loadingCls:"loading",oneLoading:!1,loadingTip:function(){alert("\u4e0a\u4e00\u6b21\u8bf7\u6c42\u5c1a\u672a\u5b8c\u6210\uff0c\u8bf7\u7a0d\u540e...")},pushState:!0,doCache:!0,doRefresh:!0,cacheLife:5,onerror:"_fallback",execGlobal:!0,scrollTo:"_target",scrollOffset:0,scrollTiming:A},M=i.data;a.augment(L,a.EventTarget,{checkQueue:function(a){var b=this[t],c=b.indexOf(a),d=b.length;if(c!=-1){b[c]=y+"||"+b[c];if(c==d-1)return;for(var e=c+1;e<d;e++)if(b[e].indexOf(y)==0){h("[CuteLink]\u7b2c "+(c+1)+" \u4e2a\u8bf7\u6c42\u5df2\u7ecf\u88ab\u7b2c "+(e+1)+" \u4e2a\u62a2\u5360","warn");return!0}}},init:function(b){function p(d){var e=this,f=d.target,h=!1;if(G(f,"form")&&d.type=="submit")h=!0;else{G(f,"a")||(f=f.parent("a"));if(!f)return}var k=c.fire(v,{target:f,originEvent:d});if(!k||k==c){var l=c.parseTarget(f,d,h);if(!a.isObject(l))return;var m=f[0].id||f.attr(q);m||f.attr(q,m=a.guid());var n=urlInfo=i.makeRealQuery(l.url),o=url=urlInfo.url;l.intfUrl!=l.url&&(n=i.makeRealQuery(l.intfUrl),o=n.url),g&&(o+=E(o)+g),o+=E(o)+"_cl_t="+m;var p=m+"::"+url;p==c.current&&b.doRefresh&&delete M[url],c.current=p;var r={isFormSubmit:h,guid:m,target:f,urlInfo:urlInfo,intfUrlInfo:n,url:url,intfUrl:o,data:M[url],scrollTo:l.scrollTo||j};if(c.isLoading&&b.oneLoading){try{b.loadingTip.call(c,r)}catch(d){}return d.halt()}b.pushState?i.history.navigate(url,c,r):c.doRequest(r),d.preventDefault()}}var c=this,b=a.merge(K,b),d=b.dataType,f=b.intfAttr,g=b.intfParam,h=b.loadingCls,j=b.scrollTo,k=b.scrollOffset,l=e(b.baseCamp),m=e(b.target);if(!l.length)return c;b.scrollTo=="_target"&&(j=b.scrollTo=m),b=c.config=b,c.isLoading=!1,l.on("click",p);var o=G(l,"form")?l:e("form",l[0]);o.length&&!b.nativeSubmit&&o[0].method.toLowerCase()!="post"&&o.on("submit",p),c.id=b.id||a.guid(),c.base=l,c.target=m,c[t]=[],c.on(b.scrollTiming,function(a){a.scrollTo?I(a.scrollTo,k):n}),c.on(B,function(a){var d=b.onerror;d==="_fallback"?window.location=a.url:J.call(c,d,a)}),c.on(z,function(a){d=="html"&&m.html(a.data),c.fire(A,a)}),c.on(A,function(a){if(b.execGlobal){var e=c.builder.callbacks,f=c.id;if(d=="html"&&f){var g=e[f];g&&g.call(a)}else J.call(c,e,a.data,a)}})},getIntfUrl:function(b,c){var d=this,e=d.config,f=e.intfAttr,g=c&&c.attr(f),h,j=e.intf;if(j=="_global"||a.isFunction(j))j=d.builder.intf;switch(j){case"_default":intfUrl=g||b;break;case"_self":intfUrl=b;break;case"_indie":intfUrl=g;break;default:intfUrl=j+E(j)+i.getUrlSearch(b)}return intfUrl},parseTarget:function(b,c,d){var e=this,f=e.config,g=b.attr("href"),h=f.intfAttr,i=b.attr(h),j=g,k=n,m=n,o,p=f.intf;if(d){var q=b,r=q[0],s=r.elements,t=r.action,u={};a.isFunction(f.beforeSubmit)&&f.beforeSubmit.call(e,r),a.each(s,function(a){var b=a.name,c=a.value;b&&(u[b]=D(c))}),j=t,a.isEmptyObject(u)||(j+=E(t)+a.param(u))}if(!!j&&!/^(#|javascript:)/.test(j)){if(a.isFunction(p)){o=p.call(e,b,c),a.isObject(o)?o.scrollTo=m:n;return o}l.test(j)?(m=j.match(l)[0],j=j.replace(m,n)):m=f.scollTo,k=e.getIntfUrl(j);return{scrollTo:m,intfUrl:k,url:j}}},doRequest:function(b){var c=this,d=c.config,e=c.target,f=d.loadingCls;b.data&&(b.hasCache=!0),c.fire(w,b);if(b.hasCache){c.render(b);return!0}var g=b.url,h=b.intfUrl,i=b.guid,j=b.target,k=i+"||"+h;c[t].push(k),c.fire(x,b),e.addClass(f),c.isLoading=!0,a.io({url:h,success:function(d){b.data=d,c.isLoading=!1,e.removeClass(f);if(!d)c.fire(B,b);else{var h=c.config.cacheLife*6e4;M[g]=d,a.later(function(){delete M[g]},h),c.checkQueue(k)||c.render(b),c.fire(y,b)}},complete:function(a,b){c.isLoading=!1,e.removeClass(f)},error:function(a){c.isLoading=!1,e.removeClass(f),b.data=a,c.fire(B,b)},dataType:c.config.dataType})},render:function(a){this.fire(z,a)},load:function(a){this.doRequest({url:a,intfUrl:this.getIntfUrl(a),noPushState:!0,data:i.data[a]})},reset:function(){self[t]=[]}}),a.augment(i,{register:function(a){var b=new L(a);i.camps.push(this.camps[b.id]=b),b.builder=this;return b}})})